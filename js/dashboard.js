window.onload = function() {

  var mathe_json = {'mathematiker': 
  [
  {
    'name': 'Pythagoras von Samos',
    'required_points':'5',
    'bild': 'images/mathematiker_final/pythagoras.png',
    'trophy': 'images/trophies/pythagoras_trophy.svg',
    'credit_bild':' By The original uploader was Galilea at German Wikipedia - First upload to Wikipedia: de.wikipedia; description page is/was here.(Original text: Fotografiert am 30.03.2005) Second upload to Commons: http://commons.wikimedia.org/wiki/Image:Kapitolinischer_Pythagoras.jpg and this is an adjusted version of the second one., CC BY-SA 3.0, https://commons.wikimedia.org/w/index.php?curid=2580073',
    'prolog_text': 'Ich bin der gro&szlig;artige Pythagoras von Samos, Meister des Dreiecks, Enttarner der geometrischen Mysterien und Begr&uuml;nder der Allgemeinen Mathematik. Ohne mir m&uuml;sstest du keine Schularbeiten schreiben und in einem sch&auml;ndlichen Erdloch leben, in dem du dich wundern w&uuml;rdest, wie man die fehlende Seite eines gleichseitigen Dreiecks ausrechnet. Ich habe mein Leben damit verbracht, alles Wissen der Menschheit in mich aufzusaugen und nebenbei philosophische Lehren entwickelt. Sieh es ein, du kannst mich nicht besiegen. Mathematisch ausgedr&uuml;ckt bin ich die Hypothenuse und du eine der beiden Katheten. Deine Gr&ouml;&szlig;e kann meine nie &uuml;berschreiten. Das ist mathematisch bewiesen, QED. Deswegen bleibe ich unbesiegbar. Deswegen kannst du nicht gewinnen.Ich bin der gro&szlig;artige Pythagoras von Samos, Meister des Dreiecks, Enttarner der geometrischen Mysterien und Begr&uuml;nder der Allgemeinen Mathematik. Ohne mir m&uuml;sstest du keine Schularbeiten schreiben und in einem sch&auml;ndlichen Erdloch leben in dem du dich wundern w&uuml;rdest, wie man die fehlende Seite eines gleichseitigen Dreiecks ausrechnet. Ich habe Leben damit verbracht alles Wissen der Menschheit in mich aufzusaugen und nebenbei Philosophische Lehren entwickelt. Sieh es ein, du kannst mich nicht besiegen. Mathematisch ausgedr&uuml;ckt bin ich die Hypothenuse und du eine der beiden Katheten. Deine Gr&ouml;&szlig;e kann meine nie &uuml;berschreiten. Das ist mathematisch bewiesen, QED. Deswegen bleibe ich unbesiegbar. Deswegen kannst du nicht gewinnen.',
    'epilog_text': 'Du hast mich besiegt?!! Das muss bedeuten, dass du gar keine kleine, unn&ouml;tige Kathete, sondern etwas besseres, bist. H&ouml;chst interessant. ich werde dar&uuml;ber nachdenken, warum ich dich so falsch eingesch&auml;tzt habe. Meinen Respekt hast du dir verdient.',
  },
  {
    'name': 'Johann Carl Friedrich Gau&szlig;',
    'required_points':'10',
    'bild': 'images/mathematiker_final/gauss.png',
    'trophy': 'images/trophies/gauss_trophy.svg',
    'credit_bild':'By The original uploader was Galilea at German Wikipedia - First upload to Wikipedia: de.wikipedia; description page is/was here.(Original text: Fotografiert am 30.03.2005) Second upload to Commons: http://commons.wikimedia.org/wiki/Image:Kapitolinischer_Pythagoras.jpg and this is an adjusted version of the second one., CC BY-SA 3.0, https://commons.wikimedia.org/w/index.php?curid=2580073',
    'prolog_text': 'Johann Carl Friedrich Gau&szlig; (der F&uuml;rst der Mathematiker) ist mein Name und ich bin der genialste Kopf meiner Zeit. Ich bin nicht nur unglaublich schlau, sondern auch von erhabenem Ehrgeiz durchstr&ouml;mt. "Man kann mit der Wurzel aus -1 nichts anfangen" haben sie gesagt. Man muss akzeptieren, dass es Grenzen gibt" haben sie gesagt. Ich habe nicht akzeptiert, dass es Grenzen gibt und den Komplexen Zahlenraum begr&uuml;ndet. Des Weiteren habe ich die Mathematik in vielen weiteren Bereichen revolutioniert: Nicht-euklidische Geometrie, euklidische Konstruktion, Primzahlenverteilung, Wahrscheinlichkeitsrechnung, Eliptische Funktionen und Algebra um nur ein paar zu nennen. wenn ich in der heutigen Zeit geboren w&auml;re, h&auml;tten wir fliegende Autos und den Warp-Antrieb. Um dich zu besiegen, verwende ich mein eigenes Eliminationsverfahren.',
    'epilog_text': 'Oh nein, du hast mich besiegt! das hei&szlig;t wohl, dass du keine lineare Gleichung bist. Ich habe dich untersch&auml;tzt. Ich werde meine mathematischen Kollegen warnen, damit sie dich aufhalten k&ouml;nnen.',
  },
  {
    'name':'Gottfried Wilhelm Leibniz',
    'required_points':'15',
    'bild': 'images/mathematiker_final/leibniz.png',
    'trophy': 'images/trophies/gauss_trophy.svg',
    'credit_bild':'Von Christoph Bernhard Francke - /gbrown/philosophers/leibniz/BritannicaPages/Leibniz/LeibnizGif.html, Gemeinfrei, https://commons.wikimedia.org/w/index.php?curid=146619',
    'prolog_text': 'Gr&uuml;&szlig; Gott, Reisender! Gottfried Wilhelm Leibniz mein Name, zu meinen Werken z&auml;hlen eine revolution&auml;re Rechenmaschine, die Einf&uuml;hrung des Bin&auml;rsystems, womit ich den Grundstein f&uuml;r die moderne Computertechnologie gelegt habe, die Infinitesimalrechnung, den Beweis f&uuml;r einen Gott und viele mehr. Meine mathematischen Arbeiten haben auch viele praktische Anwendungen, unter anderem Pl&auml;ne f&uuml;r das Uboot, eine Maschine zur Bestimmung der Windgeschwindigkeit und Anwendung im Bergbau. Mein Werk ist jedoch nicht auf die Mathematik beschr&auml;nkt, in den Bereichen Logik, Philosophie, Linguistik und Rechtswesen. Ein Plebejer wie du kann mich niemals besiegen!',
    'epilog_text': 'Was?!! Wie konnte ein so gew&ouml;hnlicher B&uuml;rger mich in meinem eigenen Element schlagen? Geh jetzt bitte, ich muss wohl meinen Gottesbeweis noch einmal &uuml;berarbeiten.',
  },
  {
    'name':'Fibonacci',
    'required_points':'20',
    'bild': 'images/mathematiker_final/fibonacci.png',
    'trophy': 'images/trophies/fibonacci_trophy.svg',
    'credit_bild':'Von Hans-Peter Postel - Eigenes Werk, CC BY 2.5, https://commons.wikimedia.org/w/index.php?curid=1739679',
    'prolog_text': 'Gr&uuml;&szlig;e, Suchender! Mein Name ist Leonardo da Pisa, oder auch Fibonacci, wie mich die Untertanen nennen! Noch heute kann man meine Statue im Campo Santo in Pisa begutachten! Im Jahre 1202 erfand ich die Fibonacci-Folge, um das exponentielle Wachstum von Kaninchen, den Niederbemittelten darzustellen. Diese Erfindung war so genial, dass noch heute in eurem "Mathematik"-Unterricht versucht wird, sie zu ergr&uuml;nden! Ich nehme jede Herausforderung an, in der Hoffnung, dass einer von euch mich &uuml;bertrumpfen kann. Jedoch habe ich wenig Glauben daran, ein solche Vorkommnis noch zu erleben.',
    'epilog_text': 'Ich ziehe meine Kapuze vor euch, ehrenwerter Mathematiker und Philosoph. Ihr habt meine Leidenschaft f&uuml;r die Mathematik wieder erweckt und meine Hoffnungen f&uuml;r die Zukunft neu entfacht! Gesinnt euch wohl!',
  },
  {
    'name':'Leonard Euler',
    'required_points':'25',
    'bild': 'images/mathematiker_final/euler.png',
    'trophy':'images/trophies/euler_trophy.svg',
    'credit_bild':'By Jakob Emanuel Handmann - 2. Kunstmuseum Basel1. digitized version, the source (scanner) of the digitized image is unknown.The image was transferred from en.wiki (en:Image:Leonhard Euler.jpg) under the {{PD-old}} license tag. Wars 16:56, 25 June 2006 (UTC), Public Domain, https://commons.wikimedia.org/w/index.php?curid=893656',
    'prolog_text': 'Willkommen in meiner Welt, Fremder! Ich bin Leonard Euler, Begr&uuml;nder der Analysis, Namensstifter der eulerschen Zahl und der eulerschen Formel und vieles mehr. Ein Gro&szlig;teil der mathematischen Symbolik, die heute noch benutzt wird, stammt von mir. Grunds&auml;tzlich w&auml;rt ihr ohne mich komplett im Eck. Ich habe in meiner Lebenszeit &uuml;ber 800 Publikationen ver&ouml;ffentlicht, was selbst f&uuml;r einen hauptberuflichen Mathematiker sehr produktiv ist. Doch ich war auch als Physiker aktiv, so habe ich unter anderem die Hydrodynamik revolutioniert. Die Stabilit&auml;tstheorie geht ebenfalls auf mich zur&uuml;ck! Versuch das mal zu &uuml;berbieten!',
    'epilog_text': 'Aber... wie?!! Wie konnte ich besiegt werden? Das ist doch nicht m&ouml;glich? Das muss eine Halluzination sein! Geh mir aus dem Licht, du unsinniges Produkt meines Gehirns!',
  },
  {
    'name': 'Sir Isaac Newton',
    'required_points':'30',
    'bild': 'images/mathematiker_final/newton.png',
    'trophy':'images/trophies/newton_trophy.svg',
    'credit_bild':'By Sir Godfrey Kneller - http://www.newton.cam.ac.uk/art/portrait.html, Public Domain, https://commons.wikimedia.org/w/index.php?curid=37337',
    'prolog_text': 'Man spricht mich mit "Sir Isaac Newton" an. Ja, ich wurde zum Ritter geschlagen und das ist die geringste Errungenschaft meines Lebens. Ich hab die Gesetze der Optik ergr&uuml;ndet. Dass wir Wissen, dass wei&szlig;es Licht aus der Überlappung des gesamten sichtbaren Spektrums besteht, ist auch mir zu verdanken und dann w&auml;re da noch die Sache mit der Gravitation. Ein Freund fragte mich einst, warum sich Planeten in elliptischen Umlaufbahnen bewegen. Also erfand ich den n&auml;chsten Wochen die Integral- und Differentialrechnung, um ihm eine zufriedenstellende Antwort geben zu können. All das war vor meinem 26. Geburtstag. Die meisten Leute schaffen es nicht einmal die mathematischen Grunds&auml;tze, die ich in meiner Jugend begr&uuml;ndet habe, in ihrer geistigen H&ouml;he zu verstehen. Bevor du gegen mich gewinnst, werde ich von einem Apfel erstochen!',
    'epilog_text': 'Was? Du hast gewonnen? Das zu erkl&auml;ren, ist mit derzeitiger Mathematik unm&ouml;glich! Ich muss wohl wieder neue Mathematik erfinden, um das verstehen zu k&ouml;nnen.',
  },
  {
    'name': 'G&uuml;nther Kauer & Stephan Javurek',
    'required_points': '35',
    'bild':'images/mathematiker_final/kauerjavurek.png',
    'trophy':'images/trophies/kauer_javurek_trophy.svg',
    'prolog_text': 'K: "Vor dir steht das Dreamteam der Mathematik: G&uuml;nther Kauer & Stephan Javurek. Ich bin das Alpha..."J: "...und ich das Omega. Wir sind die unbezwingbare Elite der modernen Mathematik. Die alten Meister konntest du besiegen, doch wir studierten ihr Werk und ihren Brauch, setzten unsere eigenen Ans&auml;tze und revolutionierten so den Mathematikuterricht." K: "Wir sch&auml;tzen die alten Meister, doch machen nicht den gleichen Fehler, dich zu untersch&auml;tzen. Da die Passion des Unterrichtens in unseren Adern pulsiert, ist jede mathematische Erkenntnis, die du erringst, auch ein Triumph f&uuml;r uns. Deswegen kannst du uns nicht besiegen. Wir sind nicht deine Gegner, sondern deine Lehrer. Wenn du Fragen zu etwas hast, kannst du immer auf uns z&auml;hlen!" J: "Gehe nun und lasse dich vom Zauber der Mathematik inspirieren!"', 
    'epilog_text': 'K & J: "Du hast wirklich genug Punkte gesammelt, um uns zu &uuml;bertrumpfen, nicht schlecht. Oder hast du vielleicht einfach geschummelt? :^) Wie auch immer, bei der Schularbeit, kannst du das nicht bringen, du kleiner Wicht :)."',
}
]
};

  var acquired_points = parseInt(getPoints()) || 0;
  document.getElementById('current_points').innerHTML = acquired_points;
  var maxPoints = 35;

  var tag = document.createElement('script');

  tag.src = "https://www.youtube.com/iframe_api";
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

  var playerVid1;
  var playerVid2;

  function loadMaths(){
    var path = '';
    var name = '';
    var text = '';
    var boxTemplate = '';
    document.getElementById('content_tower').innerHTML = "";
    for(var i = mathe_json.mathematiker.length - 1; i >= 0; i--){
      path = mathe_json.mathematiker[i].bild;
      name = mathe_json.mathematiker[i].name;
      epi_text = mathe_json.mathematiker[i].epilog_text;
      pro_text = mathe_json.mathematiker[i].prolog_text;
      req_points = parseInt(mathe_json.mathematiker[i].required_points);

      boxTemplate = '<div class="row"><div class="box imagebox" style="background-image: url(images/Cross_Maths.png); background-size:100%; background-position: 27px; background-repeat: no-repeat;"><img src="' + path + '" class="mathematic" style="opacity:0.4"/></div><div class="box textbox"><div><h1>' + name + '</h1><p>' + epi_text + '</p></div></div></div>';
      boxTemplateEnemy = '<div class="row"><div class="box imagebox"><img src="' + path + '" class="mathematic"/></div><div class="box textbox"><div><h1>' + name + '</h1><h3>Ben&ouml;tigte Punkte: ' + req_points + '</h3><p>' + pro_text + '</p></div></div></div>'
      if(acquired_points > req_points){
        document.getElementById('content_tower').innerHTML += boxTemplate;
      } else if(req_points - 5 <  acquired_points) {
        document.getElementById('content_tower').innerHTML += boxTemplateEnemy;
      } else if(name === "Pythagoras von Samos"){
        document.getElementById('content_tower').innerHTML += boxTemplateEnemy;
      }

    }
  }

  loadMaths();

  /* 
  /   Navigation zwischen Tower, Fight, Training und Trophies
  */
  document.getElementById('nav_tower').addEventListener("click", clickNavLink);
  document.getElementById('nav_fight').addEventListener("click", clickNavLink);
  document.getElementById('nav_training').addEventListener("click", clickNavLink);
  document.getElementById('nav_trophies').addEventListener("click", clickNavLink);


  function clickNavLink(){
  	var x = this.getAttribute("id").replace("nav", "content");
  	var allContent = document.querySelectorAll("div[id^='content_']");

  	for (var i = 0; i < allContent.length; i++) {
  		allContent[i].style.display = "none";
  	}
    loadMaths();
  	document.getElementById(x).style.display = "block";
  }

  /* 
  /   Navigation im Fight zwischen Funktionen, Vektoren und Textbeispielen
  */
  document.getElementById('btn_funktionen').addEventListener("click", functionClick);
  document.getElementById('btn_vektoren').addEventListener("click", functionClick);
  document.getElementById('btn_textbsp').addEventListener("click", functionClick);
  
  function functionClick(){
    var x = this.getAttribute("id").replace("btn", "tab");
    var allContent = document.querySelectorAll("div[id^='tab_']");

    for (var i = 0; i < allContent.length; i++) {
      allContent[i].style.display = "none";
    }

    document.getElementById(x).style.display = "block";
  }

  /* 
  /   Navigation im Fight zwischen Funktionen, Vektoren und Textbeispielen
  */
  function setPoints(poi){
    window.localStorage.setItem('CurPoints', poi);
  }

  function getPoints(){
    return window.localStorage.getItem('CurPoints');
  }

  function getPointsInt(inter){
    setInterval(function(){ 
      var cur = window.localStorage.getItem('CurPoints');
      var a = document.getElementById("points");
      outputTrophies(cur);
      document.getElementById('current_points').innerHTML = cur;
      acquired_points = cur;
      ueberpruefen(cur);
    }, inter);
  }

  function outputTrophies(points){
    var links = ["./images/trophies/pythagoras_trophy.svg", "./images/trophies/gauss_trophy.svg", "./images/trophies/leibniz_trophy.svg",  "./images/trophies/fibonacci_trophy.svg", "./images/trophies/euler_trophy.svg", "./images/trophies/newton_trophy.svg"];
    for (var i = 0; i < Math.floor(points/5); i++) {
      var x = document.getElementsByClassName("trophy");
      x[i].src = links[i];
    }

  }

  function ueberpruefen(cp) {
    var el = document.getElementById("rectpartie");

    var towerStyles = window.getComputedStyle(document.getElementById("left"));
    var towerHeight = towerStyles.height.replace("//\D*$/g", "");
    towerHeight = parseFloat(towerHeight);

    var towerBgImage = towerStyles.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi, '$2').split(',')[0];

    var image = new Image();
    image.src = towerBgImage;

    var towerBgHeight = image.height;
    var towerBgWidth = image.width;

    var currentTowerWidth = ((towerHeight / towerBgHeight) * towerBgWidth) - 5;
    var proportion = (towerHeight / maxPoints) * cp;

    el.style.width = currentTowerWidth.toString() + "px";
    el.style.height = proportion.toString() + "px";
  }

  function onYouTubeIframeAPIReady() {
    playerVid1 = new YT.Player('vid1', {
      height: '315',
      width: '560',
      videoId: 'lDPHdcuu9Ps'
    });

    playerVid2 = new YT.Player('vid2', {
      height: '315',
      width: '560',
      videoId: 'fwnAmaZyiDo'
    });
  }

  setPoints(10);
  getPointsInt(2000);

};
